// Generated by CoffeeScript 1.6.3
(function() {
  define(function(require, exports, module) {
    var DOT_SIZE, Stars, Z_FAKTOR, createDot;
    Z_FAKTOR = 10;
    DOT_SIZE = 2;
    createDot = function() {
      return {
        x: -WIDTH + Math.random() * WIDTH * 2,
        y: -HEIGHT + Math.random() * HEIGHT * 2,
        z: Math.random() * Z_FAKTOR,
        r: (Math.random() + 1) * DOT_SIZE
      };
    };
    Stars = (function() {
      function Stars(model) {
        var i, _i;
        this.model = model;
        this.arrayDots = [];
        for (i = _i = 0; _i <= 250; i = ++_i) {
          this.arrayDots.push(createDot());
        }
      }

      Stars.prototype.update = function(dt) {
        var c_x, c_y, dot, dx, dy, _i, _len, _ref;
        this.moveFactor = 0.5;
        this.model.background.angle += -this.model.inputDirection.x * 0.01;
        _ref = this.arrayDots;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          dot = _ref[_i];
          dx = -this.model.inputDirection.x * dot.z * this.moveFactor;
          dy = -this.model.inputDirection.y * dot.z * this.moveFactor;
          if (this.model.inputDirection.x !== 0) {
            this.model.background.angle = Math.min(5, this.model.background.angle);
            c_x = this.model.inputDirection.x * -this.model.background.angle;
            c_y = this.model.inputDirection.x * this.model.background.angle * 2;
            dot.x += c_x + dx;
            dot.y += c_y + dy;
          } else {
            this.model.background.angle = 1;
            dot.x += dx;
            dot.y += dy;
          }
          if (dot.x >= WIDTH) {
            dot.x = -WIDTH;
          } else if (dot.x <= -WIDTH) {
            dot.x = WIDTH;
          }
          if (dot.y >= HEIGHT) {
            dot.y = -HEIGHT;
          } else if (dot.y <= -HEIGHT) {
            dot.y = HEIGHT;
          }
        }
        if (Math.abs(this.model.inputDirection.x) + Math.abs(this.model.inputDirection.y) >= 0.1) {
          return this.model.background.scale = Math.max(1, this.model.background.scale - 0.001);
        } else {
          return this.model.background.scale = Math.min(1.05, this.model.background.scale + 0.001);
        }
      };

      Stars.prototype.render = function(c) {
        var dot, _i, _len, _ref;
        c.save();
        c.scale(this.model.background.scale, this.model.background.scale);
        c.fillStyle = "rgba( 255, 255, 255, 0.6 )";
        _ref = this.arrayDots;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          dot = _ref[_i];
          c.beginPath();
          c.fillRect(~~dot.x, ~~dot.y, dot.r, dot.r);
          c.fill();
        }
        return c.restore();
      };

      return Stars;

    })();
    return Stars;
  });

}).call(this);
