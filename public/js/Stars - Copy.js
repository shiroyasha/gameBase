// Generated by CoffeeScript 1.6.3
(function() {
  define(function(require, exports, module) {
    var DOT_SIZE, Stars, Z_FAKTOR, createDot;
    Z_FAKTOR = 10;
    DOT_SIZE = 2;
    createDot = function() {
      return {
        x: -WIDTH + Math.random() * WIDTH * 2,
        y: -HEIGHT + Math.random() * HEIGHT * 2,
        z: Math.random() * Z_FAKTOR,
        r: (Math.random() + 1) * DOT_SIZE
      };
    };
    Stars = (function() {
      function Stars(model) {
        var i, _i;
        this.model = model;
        this.arrayDots = [];
        for (i = _i = 0; _i <= 500; i = ++_i) {
          this.arrayDots.push(createDot());
        }
      }

      Stars.prototype.update = function(dt) {
        var angle, beta, c_length, c_x, c_y, dot, dx, dy, wannabex, wannabey, _i, _len, _ref;
        this.moveFactor = 2.18;
        this.model.background.angle += -this.model.inputDirection.x * 0.005;
        this.model.background.angle %= Math.PI * 2;
        if (this.model.inputDirection.x !== 0) {
          console.log(this.model.background.angle, Math.PI / 2);
        }
        _ref = this.arrayDots;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          dot = _ref[_i];
          dx = -this.model.inputDirection.x * dot.z * this.moveFactor;
          dy = -this.model.inputDirection.y * dot.z * this.moveFactor;
          wannabex = dot.x + dx;
          wannabey = dot.y + dy;
          if (this.model.inputDirection.y === 0 && this.model.inputDirection.x !== 0) {
            dy = Math.abs(dy) * 1000;
            angle = Math.abs(this.model.background.angle);
            c_length = Math.sqrt(Math.abs(2 * dy * dy * (1 - Math.cos(angle)))) / 1000;
            beta = (Math.PI - angle) / 2;
            c_x = c_length * Math.cos(Math.PI / 2 - beta);
            c_y = c_length * Math.sin(Math.PI / 2 - beta);
            dot.x = wannabex - c_x;
            dot.y = wannabey + c_y;
          } else {
            dot.x = wannabex;
            dot.y = wannabey;
          }
          if (dot.x >= WIDTH) {
            dot.x = -WIDTH;
          } else if (dot.x <= -WIDTH) {
            dot.x = WIDTH;
          }
          if (dot.y >= HEIGHT) {
            dot.y = -HEIGHT;
          } else if (dot.y <= -HEIGHT) {
            dot.y = HEIGHT;
          }
        }
        if (Math.abs(this.model.inputDirection.x) + Math.abs(this.model.inputDirection.y) >= 0.1) {
          return this.model.background.scale = Math.max(1, this.model.background.scale - 0.001);
        } else {
          return this.model.background.scale = Math.min(1.05, this.model.background.scale + 0.001);
        }
      };

      Stars.prototype.render = function(c) {
        var dot, _i, _len, _ref;
        c.save();
        c.translate(this.model.me.position.x, this.model.me.position.y);
        c.rotate(this.model.background.angle);
        c.scale(this.model.background.scale, this.model.background.scale);
        c.fillStyle = "rgba( 255, 255, 255, 0.6 )";
        _ref = this.arrayDots;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          dot = _ref[_i];
          c.beginPath();
          c.fillRect(~~dot.x, ~~dot.y, dot.r, dot.r);
          c.fill();
        }
        return c.restore();
      };

      return Stars;

    })();
    return Stars;
  });

}).call(this);
